# unscrewup the hostname every way I can think of
sudo hostname chef.infinitemonkeys.info           ;
sudo bash -c 'echo "184.72.52.22 chef.infinitemonkeys.info " >> /etc/hosts' ;
sudo bash -c 'echo "chef.infinitemonkeys.info" > /etc/hostname' ;
sudo sysctl -w kernel.hostname=chef.infinitemonkeys.info ;

# Broaden the apt universe
sudo sed -i 's/universe/multiverse universe/' /etc/apt/sources.list
sudo bash -c 'echo "deb http://us.archive.ubuntu.com/ubuntu karmic main restricted"     >> /etc/apt/sources.list ';
sudo bash -c 'echo "deb http://us.archive.ubuntu.com/ubuntu karmic universe multiverse" >> /etc/apt/sources.list ';
sudo apt-get -y update  ;
sudo apt-get -y upgrade ;

# interactive
sudo apt-get -f install ;
sudo apt-get install -y sun-java6-jre sun-java6-jdk g++ emacs23-nox ec2-api-tools ec2-ami-tools ;

sudo apt-get install -y ruby ruby1.8-dev libopenssl-ruby1.8 rdoc ri irb rubygems rake build-essential wget ssl-cert git-core zlib1g-dev libxml2-dev ;
# unchain rubygems from the tyrrany of ubuntu
sudo gem install --no-rdoc --no-ri rubygems-update --version=1.3.6 ; sudo /var/lib/gems/1.8/bin/update_rubygems; sudo gem update --no-rdoc --no-ri --system ; gem --version ;


for foo in merb-core merb-assets merb-haml merb-helpers merb-param-protection merb-slices  ; do sudo gem install --no-rdoc --no-ri --version=1.0.15  $foo ; done
# install chef and bootstrap it
sudo gem install --no-rdoc --no-ri chef ;
# In case it tries to install a newer merb-core
sudo gem uninstall --no-executables --version=1.1.0 --ignore-dependencies merb-core


wget https://gist.github.com/raw/6b48b6ce9bb13ec2138a/1e2e1fc92729f092eea378923f9e0edeef3f3bc4/chef.json -O /tmp/chef.json ;
wget https://gist.github.com/raw/6b48b6ce9bb13ec2138a/2b48849607fa7aed7bc771c40e0cc79293e12dae/solo.rb   -O /tmp/solo.rb   ;
sudo chef-solo -c /tmp/solo.rb -j /tmp/chef.json ;

# cleanup
sudo apt-get autoremove; 
sudo updatedb;

# ===========================================================================

sudo bash -c 'echo "CHIMP CHIMP CHIMP BORK BORK BORK" > /var/run/motd ' ;

sudo adduser flip  --disabled-password --gecos "" ;
sudo groupadd supergroup ;
sudo usermod -a -G supergroup,sudo,admin flip ;

sudo passwd flip ;
sudo nano /etc/ssh/sshd_config ;
ssh-keygen -t rsa ;
sudo service ssh restart;
cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys2

# cd /etc ; sudo git init ; sudo git add . ; sudo git ci -m "Initial commit" ; sudo 


# ===========================================================================

sudo bash -c 'echo "deb http://archive.cloudera.com/debian karmic-cdh3 contrib"     >> /etc/apt/sources.list.d/cloudera.list ';
sudo bash -c 'echo "deb-src http://archive.cloudera.com/debian karmic-cdh3 contrib" >> /etc/apt/sources.list.d/cloudera.list ';
curl -s http://archive.cloudera.com/debian/archive.key | sudo apt-key add - ;
sudo apt-get -y update  ;
apt-cache search hadoop
sudo apt-get install hadoop

# ===========================================================================
# as me:

ssh-keygen
scp -p s1.infinitemonkeys.info:~/.ssh/authorized_keys2 ~/.ssh/authorized_keys2
cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys2 ;
rsync  -alvi s1.infinitemonkeys.info:~/ ~/ --exclude={.cpan,.ssh,.emacs.cruft,nohup.out,.ivy,foo,ics/{koko,projects,yuploader,yupsetter,flood_monkey,collective,edamame,monkeyshines,wuclan,libs},twitterdata}


sudo apt-get -y install git-core cvs subversion exuberant-ctags tree zip openssl liblzo2-dev;
sudo apt-get -y install libpcre3-dev libbz2-dev libonig-dev libidn11-dev libxml2-dev libxml2-utils libxslt1-dev libevent-dev;
sudo apt-get -y install emacs emacs-goodies-el emacsen-common ;
sudo apt-get -y install ruby rubygems ruby1.8-dev ruby-elisp irb ri rdoc python-setuptools python-dev;
GEM_COMMAND="gem install --no-rdoc --no-ri --source=http://gemcutter.org" ;
sudo $GEM_COMMAND extlib oniguruma fastercsv json libxml-ruby htmlentities addressable uuidtools ;
sudo $GEM_COMMAND configliere wukong  ;
sudo gem uninstall beanstalk-client ;
sudo gem uninstall uuid ;
sudo gem install dustin-beanstalk-client  --source=http://gems.github.com ;



clyde.master.00.01.sda1.boot.20100327
clyde+master+00+01+/dev/sda1+/+20100327

