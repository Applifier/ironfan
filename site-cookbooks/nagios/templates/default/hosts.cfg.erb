# Generated by Chef
# host definitions

<% @nodes.each do |n| -%>
define host {
  use server
  address <%= n['ipaddress'] %>
  host_name <%= n['node_name'] %>
<% roles = ( n['roles'] || [] ) - ( n[:nagios][:hostgroups_exclude] || [] ) %>
<% if roles.length == 0 -%>
  hostgroups all
<% else -%>
  hostgroups <%= roles.join(",") %>
<% end -%>
<% if cluster = n['cluster_name'] %>
  <% image = "#{cluster}.png" %>
  icon_image <%= image %>
  statusmap_image <%= image %>
  <% parent = @clusters[ n['cluster_name'] ].first %>
  <% if parent != n['node_name'] %>
  parents <%= parent %>
  <% end %>
<% end %>
}

define hostescalation {
  contact_groups       <%= nagios_attr(:default_contact_groups).join(",") %>
  escalation_options   d,u,r
  first_notification   2
  last_notification    4
  host_name <%= n['node_name'] %>
}

define hostescalation {
  contact_groups       <%= nagios_attr(:default_escalation_groups).join(",") %>
  escalation_options   d,u,r
  first_notification   5
  last_notification    8
  host_name <%= n['node_name'] %>
}

define serviceescalation {
  service_description  *
  host_name            <%= n['node_name'] %>
  escalation_options   w,u,c,r
  first_notification   2
  last_notification    4
  contact_groups       <%= nagios_attr(:default_contact_groups).join(",") %>
}

define serviceescalation {
  service_description  *
  host_name       <%= n['node_name'] %>
  escalation_options   w,u,c,r
  first_notification   5
  last_notification    8
  contact_groups       <%= nagios_attr(:default_escalation_groups).join(",") %>
}

<% end -%>
